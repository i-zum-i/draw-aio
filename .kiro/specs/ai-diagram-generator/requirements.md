# 要件定義書

## 概要

この機能は、自然言語による指示からDraw.io形式の図を自動生成するAI作図システムを実装します。ユーザーは日本語のテキスト説明を入力することで、編集可能な.drawioファイルとPNG画像の両方を取得できるWebアプリケーションを提供します。大規模言語モデルを活用してユーザーの意図を解釈し、適切な視覚的表現を生成することで、ビジネス図や技術図の作成にかかる時間と労力を大幅に削減することを目指します。

## 要件

### 要件1

**ユーザーストーリー:** ユーザーとして、作成したい図を日本語の自然言語で説明できるようにしたい。複雑な図表記法を学ぶことなく、視覚化のニーズを素早く伝えられるようになるため。

#### 受入基準

1. ユーザーがメイン画面にアクセスした時、システムは図の説明を入力するための複数行テキスト入力エリアを表示すること
2. ユーザーが入力エリアに日本語テキストを入力した時、システムは文字エンコーディングの問題なく入力を受け付けて保存すること
3. ユーザーが妥当な長さ制限を超えるテキストを入力した時、システムはエラーなく適切に処理すること
4. ユーザーが空の入力を送信した時、システムは適切な検証メッセージを表示すること

### 要件2

**ユーザーストーリー:** ユーザーとして、シンプルなボタンクリックで図生成プロセスを開始できるようにしたい。図の作成を簡単に開始できるようになるため。

#### 受入基準

1. ユーザーが「作成」ボタンをクリックした時、システムは入力テキストをバックエンドAPIに送信すること
2. 生成プロセスが開始された時、システムは処理状況を示すローディングインジケーター（スピナー）を表示すること
3. 処理中にボタンがクリックされた時、システムは重複リクエストを防ぐためボタンを無効化すること
4. 処理が完了または失敗した時、システムは後続の使用のためボタンを再有効化すること

### 要件3

**ユーザーストーリー:** ユーザーとして、自然言語入力からDraw.io形式の図を生成してもらいたい。必要に応じてさらにカスタマイズできる編集可能な図ファイルを取得できるようになるため。

#### 受入基準

1. バックエンドが図生成リクエストを受信した時、システムは解釈のためユーザー入力をLLM（Claude）に送信すること
2. LLMがリクエストを処理した時、システムはDraw.io互換のXML構造を生成すること
3. XMLが生成された時、システムはNode.js fsモジュールを使用して.drawioファイルとして保存すること
4. .drawioファイルが作成された時、システムはファイルの一時ダウンロードURLを生成すること
5. LLMが有効なXMLの生成に失敗した場合、システムは適切なエラーメッセージを返すこと

### 要件4

**ユーザーストーリー:** ユーザーとして、生成された図のPNG画像プレビューを見たい。ファイルをダウンロードすることなく結果を素早く確認できるようになるため。

#### 受入基準

1. .drawioファイルが正常に作成された時、システムはNode.js child_processを介してDraw.io CLIを使用してPNG画像を生成すること
2. PNG生成が完了した時、システムは画像の一時URLを作成すること
3. 画像URLが利用可能になった時、システムは表示のためフロントエンドに返すこと
4. フロントエンドが画像URLを受信した時、システムは指定された画像表示エリアにPNGを表示すること
5. PNG生成が失敗した場合、システムは.drawioファイルを提供しつつ画像のエラーメッセージを表示すること

### 要件5

**ユーザーストーリー:** ユーザーとして、生成された.drawioファイルを自分のコンピューターにダウンロードしたい。Draw.ioを使用して図をさらに編集したり、将来の使用のために保存できるようになるため。

#### 受入基準

1. 図生成が成功した時、システムは.drawioファイルのダウンロードリンクを表示すること
2. ユーザーがダウンロードリンクをクリックした時、システムはユーザーのコンピューターへのファイルダウンロードを開始すること
3. ダウンロードが完了した時、ユーザーはDraw.ioで開くことができる有効な.drawioファイルを持つこと
4. まだ図が生成されていない時、ダウンロードリンクは非表示のままであること
5. 新しい図が生成された時、ダウンロードリンクは最新のファイルを指すよう更新されること

### 要件6

**ユーザーストーリー:** ユーザーとして、ログインや登録プロセスなしでシステムを使用したい。障壁なく素早く図を作成できるようになるため。

#### 受入基準

1. ユーザーがアプリケーションURLにアクセスした時、システムは認証プロンプトなしで即座にメインインターフェースを表示すること
2. ユーザーがシステム機能を使用する時、システムはユーザー認証情報やセッション管理を要求しないこと
3. ユーザーが図を生成する時、システムはユーザー固有のデータを永続的に保存することなくリクエストを処理すること

### 要件7

**ユーザーストーリー:** ユーザーとして、システムがエラーを適切に処理し、明確なフィードバックを提供してほしい。何が問題だったかを理解し、適切な行動を取れるようになるため。

#### 受入基準

1. 処理中にエラーが発生した時、システムはステータス「error」と説明的なメッセージを含むJSONレスポンスを返すこと
2. フロントエンドがエラーレスポンスを受信した時、システムはエラーメッセージを明確な形式でユーザーに表示すること
3. ネットワーク接続の問題が発生した時、システムは適切な接続エラーメッセージを表示すること
4. LLMサービスが利用できない時、システムは具体的なサービス利用不可メッセージを提供すること
5. Draw.io CLIが失敗した時、システムは画像生成に関する警告と共に.drawioファイルの提供を試行すること