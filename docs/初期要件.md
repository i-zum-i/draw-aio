## AI作図エージェントシステム 要件定義書【FIX版】

**文書バージョン: 1.0**
**作成日: 2025年8月4日**
**作成者: Gemini**

### 1\. 概要

#### 1.1. プロジェクトの目的

本プロジェクトは、自然言語による指示からDraw.io形式の図を自動生成するWebアプリケーションのMVP（Minimum Viable Product）を開発することを目的とする。利用者はブラウザ上で簡単なテキスト指示を行うだけで、編集可能な作図ファイル（.drawio）とその画像（PNG）を即座に入手でき、作図にかかる時間と手間を大幅に削減することを目指す。

#### 1.2. プロジェクトの背景

ビジネスドキュメントや技術資料の作成において、フローチャートやアーキテクチャ図などの作図は不可欠であるが、手作業での作成は多くの時間を要する。近年の大規模言語モデル（LLM）の進化により、自然言語の意図を汲み取ったコンテンツ生成が可能となっており、この技術を作図プロセスに適用することで、抜本的な業務効率化が期待できる。

#### 1.3. 用語定義

| 用語 | 説明 |
| :--- | :--- |
| **本システム** | 本要件定義書で定義するAI作図エージェントシステム全体を指す。 |
| **技術スタック** | **TypeScript**に統一する。フロントエンド、バックエンド共にTypeScriptで実装する。 |
| **mastra** | モジュール式のLLMアプリケーションを構築するための**TypeScriptフレームワーク**。本システムの**バックエンド**は`mastra`を基盤として開発する。 |
| **バックエンド** | サーバーサイドで動作する処理システム。本システムでは`mastra`で構築された**TypeScript/Node.jsアプリケーション**を指す。 |
| **フロントエンド** | 利用者が直接操作するブラウザ上のWebインターフェース。技術スタックはTypeScript（React/Next.js等）とする。 |
| **利用者** | 本システムのWebインターフェースを利用するユーザー。 |
| **Draw.io** | オープンソースの高機能な作図ツール。本システムではこのツールのファイル形式を扱う。 |
| **.drawioファイル** | Draw.ioで作成された図のデータが格納されたXMLベースのファイル。編集が可能。 |
| **LLM** | 大規模言語モデル（Large Language Model）。自然言語の解釈と生成を行うAIモデル。 |

-----

### 2\. システム概要

#### 2.1. システムコンセプト

**「チャットで話しかけるだけで、思考をカタチにする作図アシスタント」**
ログイン不要で誰でもすぐに使えるシンプルなインターフェースを提供し、利用者が思考を中断することなく、アイデアを素早く図として可視化できる体験を実現する。

#### 2.2. 全体システム構成図

本システムは、技術スタックをTypeScriptに統一し、`mastra`フレームワークで構築された「バックエンド」と「フロントエンド」から構成される。これにより、開発効率の向上とメンテナンス性の一元化を図る。フロントエンドとバックエンドの全コードは、単一のGitリポジトリ内で管理する。

*(本図は構成の理解を助けるためのイメージです)*

1.  **フロントエンド (TypeScript / React, Next.js等)**: 利用者からの自然言語入力を受け付け、バックエンドにAPIリクエストを送信する。処理結果（PNG画像、.drawioファイルリンク）を受信し、画面に表示する。
2.  **バックエンド (TypeScript / mastra, Node.js)**:
      * フロントエンドからのAPIリクエストを受け、LLMに処理を依頼する。
      * LLMが生成したXMLを元に、**Node.jsの`fs`モジュール**を利用して`.drawio`ファイルとして保存する。
      * **Node.jsの`child_process`モジュール**を利用してDraw.io CLIを外部コマンドとして実行し、PNGファイルを生成する。
3.  **LLM (Claude等)**: バックエンドから受け取った指示に基づき、Draw.ioのXML構造を生成する。
4.  **Draw.io CLI**: バックエンドのNode.js環境から呼び出され、`.drawio`ファイルからPNG画像をエクスポートする。

#### 2.3. 利用者（アクター）

  * **一般利用者**: ログインせずに本システムを利用する全ての人。特別な権限や役割分担はない。

-----

### 3\. 機能要件

#### 3.1. 機能一覧

| 機能ID | 機能名 | 概要 |
| :--- | :--- | :--- |
| FUNC-001 | 図作成指示機能 | 利用者がブラウザから自然言語で作成したい図の内容を指示する。 |
| FUNC-002 | 図生成・表示機能 | 指示内容に基づき図を生成し、結果をブラウザに表示・提供する。 |

#### 3.2. 機能詳細

##### 3.2.1. 図作成指示機能 (FUNC-001)

1.  利用者は、ブラウザ上のテキスト入力エリアに、作成したい図の内容を日本語の自然言語で入力する。
2.  利用者は、「作成」ボタンをクリックする。
3.  クリック後、入力されたテキストがバックエンドに送信される。処理中は、画面上で処理中であることが分かる表示（例：スピナー）を行う。

##### 3.2.2. 図生成・表示機能 (FUNC-002)

1.  バックエンドは、受信した自然言語を解釈し、Draw.io形式のXMLファイルを生成する。
2.  バックエンドは、生成したXMLを`.drawio`ファイルとして保存する。
3.  バックエンドは、保存した`.drawio`ファイルからPNG形式の画像ファイルを生成する。
4.  システムは、生成されたPNG画像をフロントエンドに返却し、ブラウザの画像表示エリアに表示する。
5.  システムは、生成された`.drawio`ファイルへのダウンロード用URLをフロントエンドに返却し、ダウンロードリンクとして表示する。
6.  利用者は、表示されたダウンロードリンクをクリックすることで、`.drawio`ファイルを自身のPCにダウンロードできる。

-----

### 4\. 画面要件

#### 4.1. 画面一覧

| 画面ID | 画面名 | 概要 |
| :--- | :--- | :--- |
| SCR-001 | メイン画面 | システムの全機能を提供する単一の画面。 |

#### 4.2. 画面レイアウト（ワイヤーフレーム）

シンプルさを最優先し、以下の要素で構成される単一ページのアプリケーションとする。

  * **① ヘッダー**: システムのタイトルを表示する。
  * **② 入力フォーム**:
      * **テキストエリア**: 作成したい図の内容を入力する。複数行入力が可能。
      * **作成ボタン**: 処理を開始するトリガーとなるボタン。
  * **③ 結果表示エリア**:
      * **画像表示部**: 生成されたPNG画像が表示される。初期状態では「ここに生成された図が表示されます」のようなプレースホルダーメッセージを表示する。
      * **ダウンロードリンク**: 生成された`.drawio`ファイルのダウンロードリンクが表示される。初期状態では非表示。

*(本図はレイアウトの理解を助けるためのイメージです)*

-----

### 5\. インターフェース要件

#### 5.1. フロントエンド-バックエンド間API

バックエンドは`mastra`のAPI機能を利用してエンドポイントを定義する。

| 項目 | 内容 |
| :--- | :--- |
| **エンドポイント** | `/api/generate-diagram` |
| **HTTPメソッド** | `POST` |
| **リクエスト形式** | JSON |
| **リクエストボディ** | `{"prompt": "ユーザーが入力した自然言語テキスト"}` |
| **レスポンス形式** | JSON |
| **成功レスポンス** | `{"status": "success", "imageUrl": "生成されたPNG画像への一時的なURL", "downloadUrl": "生成された.drawioファイルへの一時的なURL"}` |
| **失敗レスポンス** | `{"status": "error", "message": "エラー内容を示すメッセージ"}` |

-----

### 6\. 非機能要件

MVP開発のため、性能、可用性、拡張性などの非機能要件は、本要件定義の対象外とする。

### 7\. セキュリティ要件

MVP開発のため、認証・認可、入力値のサニタイズ、DoS攻撃対策などのセキュリティ要件は、本要件定義の対象外とする。